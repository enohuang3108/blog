---
title: é€é Vercel éƒ¨ç½² Umami
description: ç´€éŒ„å¦‚ä½•åœ¨ Vercel ä¸Šéƒ¨ç½² Umamiï¼Œä¸¦ä½¿ç”¨ Supabase ä½œç‚ºè³‡æ–™åº«
date: 2025-09-05
---
import { ImageZoom } from '@/components/ui/image-zoom.tsx';

## 1. å»ºç«‹ Supabase è³‡æ–™åº«

1. åœ¨ Vercel ä¸Šå»ºç«‹ Supabase Project (Verel æœƒè‡ªå‹•ç‚ºä½ åœ¨ Supabase ä¸Šé–‹ä¸€å€‹ Project)
   * Region é¸æ“‡ **Washington** æ©Ÿæˆ¿ã€‚
   * é¸æ“‡ **Free Plan**ã€‚
   * è¨­å®š **Database Name**ã€‚
   * å®Œæˆå»ºç«‹ã€‚
1. åœ¨ Vercel ä¸­æ‰¾åˆ° **`POSTGRES_PRISMA_URL`**ï¼Œç¨å¾Œæœƒç”¨ä¾†è¨­å®š Umami çš„ç’°å¢ƒè®Šæ•¸ã€‚

<ImageZoom client:visible>
  <img src="/2025/deploy-umami-with-vercel/umami-variables.webp" alt="umami-variables" />
</ImageZoom>


> **Supabase å…è²»æ–¹æ¡ˆæœ‰ä»¥ä¸‹é™åˆ¶**
>
> Unlimited API requests â€¢ Shared CPU â€¢ 500â€‰MB RAM â€¢ 50K MAU â€¢ 500â€‰MB database space â€¢ 5 GB bandwidth â€¢ 1 GB file storage
---

## ç‚ºä»€éº¼ Supabase é¸æ“‡é–‹åœ¨ Washington?

ä¸€é–‹å§‹é‚„è‡ªä½œè°æ˜çš„è€ƒæ…®å°ç£èˆ‡æ±äº¬å’Œé¦™æ¸¯å“ªå€‹ AWS Latency æ¯”è¼ƒä½ (å› ç‚º Supabase æ˜¯ä½¿ç”¨ AWS æ©Ÿæˆ¿)ï¼Œ ä½†å¾Œä¾†æƒ³åˆ°ä½¿ç”¨è€…çš„è«‹æ±‚ä¸¦ä¸æœƒç›´æ¥ç™¼çµ¦ Supabaseï¼Œè€Œæ˜¯ Umami å° Supabase ç™¼èµ·è«‹æ±‚ï¼Œæ‰€ä»¥è¦çœ‹çš„æ‡‰è©²æ˜¯ Umami é€å‡ºè«‹æ±‚æ™‚æ©Ÿå™¨çš„ region åœ¨å“ªé‚Šã€‚

å› ç‚º Umami æ˜¯ä½¿ç”¨ NextJS API routes ä½œç‚ºå¾Œç«¯ï¼Œæ‰€ä»¥ç•¶éƒ¨ç½²åœ¨ Vercel ä¸Šæ™‚ï¼ŒUmami çš„å¾Œç«¯æœƒè¢« Vercel éƒ¨å±¬åœ¨æŸå€‹æ©Ÿæˆ¿ä¸Šï¼Œç‚ºäº†çŸ¥é“ Vercel æŠŠ Umami éƒ¨å±¬åœ¨å“ªè£¡å¯ä»¥ä½¿ç”¨ `curl -I https://<your-umami-domain>/api/heartbeat`ä¾†æª¢æŸ¥ï¼š
```bash
$ curl -I https://<your-umami-domain>/api/heartbeat

HTTP/2 200
x-vercel-id: hkg1::iad1::xxx-xxxxxxxx-xxx
```
å¾é€™é‚Šçš„ [x-vercel-id çµæ§‹](https://vercel.com/docs/headers/response-headers#x-vercel-id)å¯ä»¥çœ‹å‡ºä¾†
`<request hit region>::<executed function region>::<request-id>`
è«‹æ±‚å…ˆé€²å…¥ **é¦™æ¸¯ (hkg1)**  CDN ç¯€é»ï¼Œåœ¨åˆ° **Virginia(iad1)** åŸ·è¡Œ Functionï¼Œæ‰€ä»¥æ—¢ç„¶å¯¦éš›åŸ·è¡Œ Function çš„æ©Ÿå™¨åœ¨ç¾åœ‹ï¼Œå°±æ²’æœ‰å¿…è¦æŠŠ Supabase é–‹åœ¨äºæ´²ï¼Œè€Œæ˜¯æ›´é è¿‘çš„ **Washington**ã€‚

(é™„ä¸Šä½¿ç”¨ [AWS Latency Test](https://awsspeedtest.com/latency) æ¯”è¼ƒçš„çµæœï¼Œä½†æœ€å¾Œæ±ºå®šä½¿ç”¨ Washington)

<ImageZoom client:visible>
  <img src="/2025/deploy-umami-with-vercel/aws-latency-test.webp" alt="aws-latency-test" />
</ImageZoom>



## 2. éƒ¨ç½² Umami åˆ° Vercel

1. Fork [Umami](https://github.com/umami-software/umami) å°ˆæ¡ˆåˆ°ä½ è‡ªå·±çš„ GitHub
2. [ç‚ºäº†å¯ä»¥é€£æ¥ Supabase](https://umami.is/docs/guides/running-on-supabase)ï¼Œéœ€è¦ä¿®æ”¹ `db/postgresql/schema.prisma`é€™å€‹æª”æ¡ˆï¼š
```prisma
datasource db {
  provider     = "postgresql"
  url          = env("DATABASE_URL")
  directUrl    = env("DIRECT_DATABASE_URL") # add this
  relationMode = "prisma"
}
```
3. æŠŠå‰›å‰›çš„æ›´æ–°æ¨åˆ° GitHub ä¸Š
4. åˆ° Vercel ä¸Š import å‰›å‰› Fork çš„ GitHub å°ˆæ¡ˆï¼Œä¸¦åŠ å…¥å…©å€‹ç’°å¢ƒè®Šæ•¸ï¼Œç¬¬ä¸€å€‹ `DATABASE_URL` å°±æ˜¯å‰›å‰›çš„ `POSTGRES_PRISMA_URL`ï¼Œç¬¬äºŒå€‹ `DIRECT_DATABASE_URL` å¯ä»¥ç›´æ¥å¾ `POSTGRES_PRISMA_URL` ä¿®æ”¹ï¼Œä½†è¼ƒè¨˜å¾— port è¦æ”¹æˆ `5432`ï¼Œçµæ§‹å¦‚ä¸‹ï¼š
```
DATABASE_URL=postgres://[db-user].[project-ref]:[db-password]@aws-0-[aws-region].pooler.supabase.com:6543/[db-name]?pgbouncer=true&connection_limit=1

DIRECT_DATABASE_URL=postgres://postgres.[my-supabase-project-id]:[db-password]@aws-0-[aws-region].pooler.supabase.com:5432/postgres
```

---

## 3. å®Œæˆéƒ¨ç½² ğŸ‰

éƒ¨ç½²å®Œæˆå¾Œï¼Œä½ å°±å¯ä»¥é€é Vercel æä¾›çš„ URL é–‹å•Ÿ Umami å¾Œå°ä¸¦é–‹å§‹ä½¿ç”¨ã€‚
Umami çš„é è¨­å¸³è™Ÿå¯†ç¢¼æ˜¯ `admin/umami`ï¼Œè¨˜å¾—é¦–æ¬¡ç™»å…¥æ™‚å»ä¿®æ”¹ç®¡ç†å“¡å¸³è™Ÿå¯†ç¢¼ã€‚
